name: Sincronizar Bancos Supabase
on:
  workflow_dispatch: # Apenas manual, sem agendamento automático
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4
      - name: Instalar dependências
        run: |
          sudo apt-get update -y
          sudo apt-get install -y jq postgresql-client
      - name: Setup IPv6 with Cloudflare WARP  # Novo step para IPv6
        uses: fscarmen/warp-on-actions@v1.0
      - name: Executar script de sincronização
        run: bash sync_prod_to_hom.sh # Se estiver em pasta, mude para: bash scripts/sync_prod_to_hom.sh
      - name: Mostrar log do script (para depuração)
        if: always()
        run: cat /home/runner/scripts/sync_log_*.txt || true
      - name: Upload log como artefato (para debug)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: sync-log
          path: /home/runner/scripts/sync_log_*.txt # Ajuste se BASE_DIR mudar no script
